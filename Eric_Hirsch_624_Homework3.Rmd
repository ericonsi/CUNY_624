---
title: "Eric_Hirsch_624_Homework_2"
output: html_document
date: "2023-02-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}

library(tidyverse)
library(tsibbledata)
library(tsibble)
library(forecast)
library(fpp3)
library(fable)

```

Exercises 1,2,3,4,7

__*1.Produce forecasts for the following series using whichever of NAIVE(y), SNAIVE(y) or RW(y ~ drift()) is more appropriate in each case:*__

__*1.a Australian Population (global_economy)*__

```{r}
ge_AUS <- global_economy %>%
  filter(Country=="Australia") %>%
  select(Population)

ge_AUS %>% autoplot()

fit <- ge_AUS %>% model(RW(Population~drift()))
fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(ge_AUS)


```

__*1.b. Bricks (aus_production)*__

```{r}
bricks <- aus_production %>%
  select(Bricks) %>%
  filter_index("1956 Q1" ~ "2005 Q2")

bricks %>% autoplot()

fit <- bricks %>% model(SNAIVE())
fit %>% forecast() %>% autoplot(bricks)


```
__*1.c NSW Lambs (aus_livestock)*__
```{r}
x <- aus_livestock
lambs <- aus_livestock %>%
  filter(Animal == "Lambs", State=="New South Wales") 

lambs %>% autoplot()

fit <- lambs %>% model(SNAIVE())
fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(lambs)


```

__* 1.d Household wealth (hh_budget).*__

```{r}

x <- hh_budget
wealth <- hh_budget %>%
  select(Wealth) 

wealth %>% autoplot()

fit <- wealth %>% model(RW(Wealth~drift()))
#fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(wealth)

```

__*Australian takeaway food turnover (aus_retail).*__

```{r}

food <- aus_retail %>%
  filter(Industry=="Takeaway food services") %>%
  select(Turnover)

food %>% autoplot()

fit <- food %>% model(SNAIVE(Turnover))
#fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(food)

```

__*2 Use the Facebook stock price (data set gafa_stock) to do the following:*__

__*2.1 Produce a time plot of the series.*__

```{r}

x<- gafa_stock
fb <- gafa_stock %>%
  filter(Symbol=="FB") %>%
  mutate(day = row_number()) %>%
  update_tsibble(index = day, regular = TRUE) %>%
  select(Close)

fb %>% autoplot(Close)

```

__*2.b_c Produce forecasts using the drift method and plot them. Show that the forecasts are identical to extending the line drawn between the first and last observations.*__

```{r}
head(fb$Close,1)
tail(fb$Close,1)

fb %>%
  model(RW(Close ~ drift())) %>%
  forecast(h=100) %>%
  autoplot(fb) +
  labs(title = "Daily Close Price for Facebook") +
  geom_segment(aes(x=0, xend=1250, y=54.71, yend = 131.09),
               colour = "red")

```

__* 2.d Try using some of the other benchmark functions to forecast the same data set. Which do you think is best? Why?*__

```{r}
fb %>%
  model(NAIVE()) %>%
  forecast(h=100) %>%
  autoplot(fb)

fb %>%
  model(MEAN()) %>%
  forecast(h=100) %>%
  autoplot(fb)
  
```

__*3. Apply a seasonal na√Øve method to the quarterly Australian beer production data from 1992. Check if the residuals look like white noise, and plot the forecasts.*__
  
```{r}
# Extract data of interest
recent_production <- aus_production %>%
  filter(year(Quarter) >= 1992)
# Define and estimate a model
fit <- recent_production %>% model(SNAIVE(Beer))
# Look at the residuals
fit %>% gg_tsresiduals()
# Look a some forecasts
fit %>% forecast() %>% autoplot(recent_production)

```
  
__*3.4 Repeat the previous exercise using the Australian Exports series from global_economy and the Bricks series from aus_production. Use whichever of NAIVE() or SNAIVE() is more appropriate in each case.*__

```{r base plot, warning = FALSE, echo=FALSE, out.width="50%"}

ausexp <- global_economy %>%
  filter(Country == "Australia") %>%
  select(Exports)

fit <- ausexp %>% model(NAIVE())
fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(ausexp)

fit <- bricks %>% model(SNAIVE())
fit %>% gg_tsresiduals()
fit %>% forecast() %>% autoplot(bricks)

```

__*3.7 For your retail time series (from Exercise 8 in Section 2.10), create a training dataset consisting of observations before 2011*__ 

```{r}

set.seed(042760)
myseries <- aus_retail %>%
  filter(`Series ID` == sample(aus_retail$`Series ID`,1)) %>%
  fill_gaps() %>%
  select(Turnover)

myseries_train <- myseries %>%
  filter(year(Month) < 2011)

autoplot(myseries, Turnover) +
  autolayer(myseries_train, Turnover, colour = "red")

fit <- myseries_train %>%
  model(SNAIVE())

fit %>% gg_tsresiduals()

fc <- fit %>%
  forecast(new_data = anti_join(myseries, myseries_train))
fc %>% autoplot(myseries)

fit %>% accuracy()
fc %>% accuracy(myseries)

```



```{r}

set.seed(042760)
myseries <- aus_retail %>%
  filter(`Series ID` == sample(aus_retail$`Series ID`,1)) %>%
  fill_gaps() %>%
  select(Turnover)

myseries_train <- myseries %>%
  filter(year(Month) < 2016)

autoplot(myseries, Turnover) +
  autolayer(myseries_train, Turnover, colour = "red")

fit <- myseries_train %>%
  model(SNAIVE())

fit %>% gg_tsresiduals()

fc <- fit %>%
  forecast(new_data = anti_join(myseries, myseries_train))
fc %>% autoplot(myseries)

fit %>% accuracy()
fc %>% accuracy(myseries)

```
